#!/usr/bin/env python3
"""
DESCRIPTOGRAFADOR - RANSOMWARE SIMULADO
Recupera arquivos criptografados na simulação
"""

from cryptography.fernet import Fernet
import os

TARGET_DIR = "test_files"
KEY_FILE = "secret.key"

def load_key():
    """Carrega chave de descriptografia"""
    try:
        with open(KEY_FILE, "rb") as f:
            return f.read()
    except FileNotFoundError:
        print("[-] Arquivo de chave não encontrado")
        return None

def decrypt_file(filepath, key):
    """Descriptografa arquivo individual"""
    f = Fernet(key)
    try:
        with open(filepath, "rb") as file:
            encrypted_data = file.read()
        decrypted_data = f.decrypt(encrypted_data)
        with open(filepath, "wb") as file:
            file.write(decrypted_data)
        print(f"[+] Descriptografado: {filepath}")
        return True
    except Exception as e:
        print(f"[!] Falha em {filepath}: {e}")
        return False

def main():
    print("=" * 50)
    print("FERRAMENTA DE DESCRIPTOGRAFIA")
    print("=" * 50)
    
    key = load_key()
    if not key:
        return
    
    if not os.path.exists(TARGET_DIR):
        print(f"[-] Pasta {TARGET_DIR} não encontrada")
        return
    
    decrypted_count = 0
    for filename in os.listdir(TARGET_DIR):
        filepath = os.path.join(TARGET_DIR, filename)
        if os.path.isfile(filepath):
            if decrypt_file(filepath, key):
                decrypted_count += 1
    
    print(f"\n[+] {decrypted_count} arquivo(s) recuperado(s)")
    print("[+] Remova manualmente: README_RESCATE.txt e secret.key")

if __name__ == "__main__":
    main()
